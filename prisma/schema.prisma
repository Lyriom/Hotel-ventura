generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// ========== USUARIOS DE LOGIN (Auth) ==========
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      String   @default("cliente") // 'admin' | 'recepcionista' | 'cliente'
  createdAt DateTime @default(now())
}

/// ========== ROLES Y STAFF ==========
model Roles {
  IdRol     Int        @id @default(autoincrement())
  NombreRol String     @unique
  Usuarios  Usuarios[]
}

model Usuarios {
  IdUsuario      Int        @id @default(autoincrement())
  Nombre         String
  Usuario        String     @unique
  ContrasenaHash String
  IdRol          Int
  Rol            Roles      @relation(fields: [IdRol], references: [IdRol])
  Reservas       Reservas[]
}

/// ========== CLIENTES ==========
model Clientes {
  IdCliente          Int         @id @default(autoincrement())
  Nombre             String
  Apellido           String
  Ciudad             String
  Correo             String      @unique
  Telefono           String
  DocumentoIdentidad String?     @unique
  Reservas           Reservas[]
  Estancias          Estancias[]
}

/// ========== CONFIGURACIÓN DE HABITACIONES ==========
model TiposHabitacion {
  IdTipoHabitacion Int            @id @default(autoincrement())
  NombreTipo       String         @unique
  Capacidad        Int
  // Nota: He quitado los precios de aquí para ponerlos en la habitación individual,
  // pero podrías dejarlos aquí como "precio sugerido" si quisieras.
  Habitaciones     Habitaciones[]
}

model Habitaciones {
  IdHabitacion     Int             @id @default(autoincrement())
  Numero           String          @unique
  IdTipoHabitacion Int
  NumeroCamas      Int
  TipoTV           String
  Estado           String          // 'Disponible', 'Mantenimiento', 'Ocupada'
  
  // --- NUEVOS CAMPOS DE PRECIO ---
  PrecioNoche      Decimal         @db.Decimal(10, 2)
  PrecioHora       Decimal?        @db.Decimal(10, 2) // Opcional si no alquilas por horas

  TipoHabitacion     TiposHabitacion      @relation(fields: [IdTipoHabitacion], references: [IdTipoHabitacion])
  ReservaHabitacion  ReservaHabitacion[]
  EstanciaHabitacion EstanciaHabitacion[]

  @@index([IdTipoHabitacion])
}

/// ========== RESERVAS ==========
model Reservas {
  IdReserva            Int       @id @default(autoincrement())
  CodigoReserva        String?   @unique
  IdCliente            Int
  IdUsuario            Int?      // Quién registró la reserva (opcional)
  FechaReserva         DateTime? @default(now())
  FechaEntradaPrevista DateTime?
  FechaSalidaPrevista  DateTime?
  Estado               String
  MontoTotalEstimado   Decimal?  @db.Decimal(10, 2)
  Observaciones        String?

  Cliente           Clientes            @relation(fields: [IdCliente], references: [IdCliente])
  Usuario           Usuarios?           @relation(fields: [IdUsuario], references: [IdUsuario])
  ReservaHabitacion ReservaHabitacion[]
  Estancias         Estancias[]

  @@index([IdCliente])
}

model ReservaHabitacion {
  IdReservaHabitacion Int          @id @default(autoincrement())
  IdReserva           Int
  IdHabitacion        Int
  PrecioPorNoche      Decimal?     @db.Decimal(10, 2) // Snapshot del precio al momento de reservar
  
  Reserva    Reservas     @relation(fields: [IdReserva], references: [IdReserva], onDelete: Cascade)
  Habitacion Habitaciones @relation(fields: [IdHabitacion], references: [IdHabitacion])

  @@unique([IdReserva, IdHabitacion])
}

/// ========== ESTANCIAS (Check-in / Check-out) ==========
model Estancias {
  IdEstancia      Int       @id @default(autoincrement())
  IdReserva       Int
  IdCliente       Int
  FechaCheckIn    DateTime?
  HoraCheckIn     DateTime?
  FechaCheckOut   DateTime?
  HoraCheckOut    DateTime?
  MontoTotalFinal Decimal?  @db.Decimal(10, 2)
  Estado          String

  Reserva            Reservas             @relation(fields: [IdReserva], references: [IdReserva])
  Cliente            Clientes             @relation(fields: [IdCliente], references: [IdCliente])
  EstanciaHabitacion EstanciaHabitacion[]

  @@unique([IdReserva, IdCliente])
}

model EstanciaHabitacion {
  IdEstanciaHabitacion Int       @id @default(autoincrement())
  IdEstancia           Int
  IdHabitacion         Int
  FechaEntradaReal     DateTime?
  FechaSalidaReal      DateTime?
  TarifaAplicada       Decimal?  @db.Decimal(10, 2) // Precio real cobrado

  Estancia   Estancias    @relation(fields: [IdEstancia], references: [IdEstancia], onDelete: Cascade)
  Habitacion Habitaciones @relation(fields: [IdHabitacion], references: [IdHabitacion])

  @@unique([IdEstancia, IdHabitacion])
}
